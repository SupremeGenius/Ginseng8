@model Ginseng.Mvc.Pages.Work.ProjectsModel

<form method="get" class="form-inline mb-3">
    <div class="form-row">
    <label class="mr-4">Sort by:</label>
    @Html.DropDownList("ProjectListSort", new SelectList(Html.GetEnumSelectList(typeof(ProjectInfoSortOptions)), "Value", "Text", Model.Sort), new { @class = "form-control", onchange = "this.form.submit();" })
    </div>
</form>
    
@*crosstab columns*@
<div class="row">
    <div class="col-@Model.CrosstabRowHeadingGridCols()">
        <span>Project</span>
    </div>
    @foreach (var ms in Model.MilestoneDates)
    {
        <div class="col-@Model.CrosstabColumnHeadingGridCols()">
            <p class="mb-0">
            @if (ms.First().ShowDate)
            {
                <span>@Html.FormatValue(ms.Key, "{0:ddd M/d}")</span>
            }
            else
            {
                <span>No Milestone</span>
            }
            </p>

            @foreach (var msName in ms)
            {
                <p class="mb-0 small">@msName.Name</p>
            }
        </div>
    }
</div>

@foreach (var appGrp in Model.ProjectInfo.GroupBy(row => row.ApplicationId))
{
    <h4>@appGrp.First().ApplicationName</h4>
    @foreach (var prj in appGrp)
    {
        <div class="row">
            <div class="col-@Model.CrosstabRowHeadingGridCols()">
                <a asp-route-id="@prj.Id" class="btn @((prj.TotalWorkItems > 0) ? "btn-info" : "btn-light")">@prj.Name</a>
                <br/><span class="text-muted small">@prj.TotalWorkItems work items / @Html.FormatValue(prj.PercentComplete, "{0:P0}") complete</span>
            </div>        
            @foreach (var ms in Model.MilestoneDates)
            {
                <div class="col-@Model.CrosstabColumnHeadingGridCols()">
                    <ul class="small">
                        @foreach (var user in Model.ProjectAssignments[new ProjectDashboardCell(prj.Id, ms.Key)].OrderByDescending(row => row.WorkItemCount))
                        {
                            <li>
                                @if (user.AssignedUserName == null)
                                {
                                    <span class="font-weight-bold">@user.WorkItemCount unassigned</span>
                                }
                                else
                                {
                                    <span>@user.WorkItemCount @user.AssignedUserName</span>
                                }
                            </li>
                        }
                    </ul>
                </div>
            }            
        </div>
        <hr/>
    }
}

<partial name="Shared/_IActive" model="Model"/>