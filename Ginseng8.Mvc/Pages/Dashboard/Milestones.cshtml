@page
@model Ginseng.Mvc.Pages.Dashboard.MilestonesModel
@{
    ViewData["Title"] = "Milestones";
}

<div id="accordion">
@foreach (var appGrp in Model.WorkItems.GroupBy(row => row.ApplicationId))
{
    <h4>@appGrp.First().ApplicationName</h4>

    <ul class="nav nav-tabs" role="tablist">
        @foreach (var milestoneGrp in appGrp.OrderBy(row => row.MilestoneDate).GroupBy(row => row.MilestoneId))
        {
            var milestoneItem = milestoneGrp.First();
            <li class="nav-item">
                <a href="#app-@appGrp.Key-ms@(milestoneGrp.Key)" data-toggle="tab" class="nav-link">
                    <partial name="Items/_MilestoneHeader" model="milestoneItem"/>
                </a>
            </li>
        }
    </ul>
    <div class="tab-content my-3" id="tabContent">
    @foreach (var milestoneGrp in appGrp.OrderBy(row => row.MilestoneDate).GroupBy(row => row.MilestoneId))
    {    
        <div id="app-@appGrp.Key-ms@(milestoneGrp.Key)" class="tab-pane fade" data-milestone-id="@milestoneGrp.Key" role="tabpanel">
            <div style="margin-left:20px">
            @foreach (var item in milestoneGrp)
            {
                <partial name="Items/_Card" model="new WorkItemCardView() { WorkItem = item, Dropdowns = Model.Dropdowns, SelectedLabels = Model.SelectedLabels[item.Id] }" />
            }
            @await Html.PartialAsync("Items/_InsertItem", new InsertItemView(new Dictionary<string, int>()
                {
                    { "applicationId", appGrp.Key },
                    { "milestoneId", milestoneGrp.Key }
                }))
            </div>
        </div>
    }
    </div>    
}
</div>